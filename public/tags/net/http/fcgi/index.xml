<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Net/Http/Fcgi on Androg</title>
    <link>kwmt27.net/tags/net/http/fcgi/</link>
    <description>Recent content in Net/Http/Fcgi on Androg</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Wed, 18 Dec 2013 00:00:00 +0000</lastBuildDate>
    <atom:link href="kwmt27.net/tags/net/http/fcgi/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>#golang でマッチングサイトを作った時の感想。</title>
      <link>/kwmt27.net/index.php/2013/12/18/golang-advent-calendar-2013/</link>
      <pubDate>Wed, 18 Dec 2013 00:00:00 +0000</pubDate>
      
      <guid>/kwmt27.net/index.php/2013/12/18/golang-advent-calendar-2013/</guid>
      <description>

&lt;p&gt;この記事は &lt;a href=&#34;http://qiita.com/advent-calendar/2013/go&#34; target=&#34;_blank&#34;&gt;Go Advent Calendar 2013&lt;/a&gt; の 18 日目の投稿です。&lt;/p&gt;

&lt;h2 id=&#34;はじめに:c0dbec7fa3cfe404e69f284d2c58d1c4&#34;&gt;はじめに&lt;/h2&gt;

&lt;p&gt;今年もいろいろと行われていますAdvent Calendarですが、初めて参加させて頂きます。プログラミング界隈のプロフェッショナルな方々の中で書くというのは、ただ1人で家で書いてるだけなのに、ちょっと緊張しちゃってます(^^ゞ　&lt;/p&gt;

&lt;p&gt;簡単にGo歴を。&lt;a href=&#34;http://bit.ly/1dJqET7&#34; target=&#34;_blank&#34;&gt;2012年1月に勉強会&lt;/a&gt;に参加してから、シンプルで守備範囲が広そうで強力で、なにより楽しいと感じ、それから自分で勉強したりして発表させて頂いたりしました(&lt;a href=&#34;http://www.slideshare.net/yasi_life/presentations&#34; target=&#34;_blank&#34;&gt;slideshare&lt;/a&gt;)。&lt;a href=&#34;http://go-talks-kwmt.appspot.com/2013/gocon-spring.slide#1&#34; target=&#34;_blank&#34;&gt;神戸からGoCon Springに参加&lt;/a&gt;したり、&lt;a href=&#34;http://bit.ly/1dJqv20&#34; target=&#34;_blank&#34;&gt;神戸から名古屋の勉強会に参加&lt;/a&gt;したりしました。&lt;/p&gt;

&lt;p&gt;そんな中、今年の10月に、マッチングサイトを作ってほしいという話があり、言語は何でもいいとのことだったので、担当者に&amp;#8221;Goはキマスよ&amp;#8221;と訴え続け、Goで作らせて頂きました。&lt;/p&gt;

&lt;p&gt;そこで、よく「Goで何ができるの？」って聞かれますので、「マッチングサイトが作れますよ」という事例を紹介したいところなのですが、そのマッチングサイトは、まだオープンしておらず、残念ながらリンクやスクリーンショットを貼ることができません。ので、そのマッチングサイトを作った時の&amp;#8221;機能&amp;#8221;と&amp;#8221;構成&amp;#8221;を簡単に説明した後、&amp;#8221;感想&amp;#8221;を書いていきたいと思います。&lt;/p&gt;

&lt;h2 id=&#34;機能:c0dbec7fa3cfe404e69f284d2c58d1c4&#34;&gt;機能&lt;/h2&gt;

&lt;p&gt;このマッチングサイトのおおまかな機能としては、以下になります。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;都道府県や店舗の特徴から、ある店舗を検索できる&lt;/li&gt;
&lt;li&gt;検索結果から、各店舗の詳細を見ることができる&lt;/li&gt;
&lt;li&gt;お問い合わせフォームから各店舗に問い合わせできる(メール送信)&lt;/li&gt;
&lt;li&gt;各店舗を、新規に登録・更新・削除することができる&lt;/li&gt;
&lt;li&gt;登録時、画像をアップロードできる&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;マッチングサイトの必要最低限の機能のイメージです。&lt;/p&gt;

&lt;h2 id=&#34;構成:c0dbec7fa3cfe404e69f284d2c58d1c4&#34;&gt;構成&lt;/h2&gt;

&lt;h4 id=&#34;サーバーの構成:c0dbec7fa3cfe404e69f284d2c58d1c4&#34;&gt;サーバーの構成&lt;/h4&gt;

&lt;p&gt;&lt;a href=&#34;http://kwmt27.net/index.php/2013/10/03/nginx-golang-fcgi-mysql/&#34; target=&#34;_blank&#34;&gt;Nginx + Golang(FastCGI) + MySQL&lt;/a&gt;で作成しました。&lt;/p&gt;

&lt;h4 id=&#34;パッケージ構成:c0dbec7fa3cfe404e69f284d2c58d1c4&#34;&gt;パッケージ構成&lt;/h4&gt;

&lt;p&gt;&lt;code&gt;main&lt;/code&gt;パッケージの他に&lt;code&gt;db&lt;/code&gt;パッケージ、&lt;code&gt;data&lt;/code&gt;パッケージ、後はテンプレートファイル(*.tmpl)です。&lt;/p&gt;

&lt;p&gt;MVCモデルのイメージで言うと、&lt;code&gt;data&lt;/code&gt;,&lt;code&gt;db&lt;/code&gt;パッケージがModelで、テンプレートはView、&lt;code&gt;main&lt;/code&gt;パッケージがControllerというイメージで作成しました。あとは、&lt;code&gt;util&lt;/code&gt;パッケージです。もちろん、db,data,utilという名前である必要はありません。&lt;/p&gt;

&lt;h4 id=&#34;各パッケージのファイル数と総ステップ数:c0dbec7fa3cfe404e69f284d2c58d1c4&#34;&gt;各パッケージのファイル数と総ステップ数&lt;/h4&gt;

&lt;ul&gt;
&lt;li&gt;mainパッケージ・・・17ファイル&lt;/li&gt;
&lt;li&gt;dataパッケージ・・・23ファイル&lt;/li&gt;
&lt;li&gt;dbパッケージ・・・2ファイル&lt;/li&gt;
&lt;li&gt;utilパッケージ・・・12ファイル&lt;/li&gt;
&lt;li&gt;テンプレートファイル・・・37ファイル&lt;/li&gt;
&lt;li&gt;総ステップ数・・・8678ステップ&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;使用した外部ライブラリ:c0dbec7fa3cfe404e69f284d2c58d1c4&#34;&gt;使用した外部ライブラリ&lt;/h4&gt;

&lt;p&gt;データベース関連&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;MySQLのドライバ：&lt;a href=&#34;https://github.com/go-sql-driver/mysql&#34; target=&#34;_blank&#34;&gt;&amp;#8220;github.com/go-sql-driver/mysql&amp;#8221;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;ORマッパー：&lt;a href=&#34;https://github.com/coopernurse/gorp&#34; target=&#34;_blank&#34;&gt;&amp;#8220;github.com/coopernurse/gorp&amp;#8221;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;画像関連&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;画像をリサイズする：&lt;a href=&#34;https://github.com/nfnt/resize&#34; target=&#34;_blank&#34;&gt;&amp;#8220;github.com/nfnt/resize&amp;#8221;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&#34;実績工数:c0dbec7fa3cfe404e69f284d2c58d1c4&#34;&gt;実績工数&lt;/h4&gt;

&lt;p&gt;実装2人で約30人日(デザイン除く)&lt;/p&gt;

&lt;h2 id=&#34;感想:c0dbec7fa3cfe404e69f284d2c58d1c4&#34;&gt;感想&lt;/h2&gt;

&lt;p&gt;(これだけではイメージ沸かないですよね・・・すみません。。。感想に入らせて頂きます。)&lt;/p&gt;

&lt;p&gt;●現在、&lt;a href=&#34;http://robfig.github.io/revel/&#34; target=&#34;_blank&#34;&gt;Revel&lt;/a&gt;と先日の海外のAdvent Calenderで発表がありました&lt;a href=&#34;http://blog.gopheracademy.com/day-05-beego&#34; target=&#34;_blank&#34;&gt;beego&lt;/a&gt;というフレームワークがありますが、このくらいの規模ならフレームワークは不要かなと思いました。&lt;/p&gt;

&lt;p&gt;●ORMの&lt;a href=&#34;https://github.com/coopernurse/gorp&#34; target=&#34;_blank&#34;&gt;gorp&lt;/a&gt;を使わず、ゴリゴリSQLをかいても出来ますが、gorpにより非常に楽させてもらいました。個人的には使いやすかったと思います。&lt;/p&gt;

&lt;p&gt;●標準パッケージでテンプレート(&lt;a href=&#34;http://golang.org/pkg/html/template/&#34; target=&#34;_blank&#34;&gt;html/template&lt;/a&gt;)が使え、改めてフレームワークなどを入れる必要がないので、余計な使い方を覚える必要がないのが個人的には良いと思いました。&lt;/p&gt;

&lt;p&gt;●デザイン部分はデザイナーさんが担当したのですが、&lt;code&gt;if&lt;/code&gt;文などのプログラミングがわかならなくても、&amp;#8221;{{}}部分はプログラムしていますが、他のところはいじってもらって大丈夫です&amp;#8221;ぐらいの説明で、テンプレートファイルを容易に理解して頂いたので、楽でした。&lt;/p&gt;

&lt;p&gt;●&lt;code&gt;{{define &amp;quot;header&amp;quot;}}ヘッダー{{end}}&lt;/code&gt;のようにモジュール化でき、&lt;code&gt;{{template &amp;quot;header&amp;quot;}}&lt;/code&gt;のようにして、モジュールを呼び出すことが出来ますが、あたりまえかもしれませんが、これもやみくもにモジュール化するのではなくて、分かりやすい構成にした方がよいと感じました。&lt;/p&gt;

&lt;p&gt;●テンプレートファイルの読み込みの仕方によっては、Goのバイナリを再コンパイルしなくても更新されるのは、非常に重宝しました。デザイナーさんがデザインを変更しても、ブラウザの更新だけでデザインの変更が確認できるからです。&lt;/p&gt;

&lt;p&gt;このようにする読み込みの仕方は、テンプレートファイルをParseするときに、関数の外で読み込まないことです。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;func RootHandler(w http.ResponseWriter, r *http.Request) {
    tmpl := template.New(&#34;main.tmpl&#34;)
    tmpl = template.Must(tmpl.ParseGlob(&#34;templates/*.tmpl&#34;))
    data = ・・・
    tmpl.Execute(w,data)
    ・・・
}
&lt;/pre&gt;

&lt;p&gt;つまり、次のようにしてしまうと、ブラウザの更新だけでは更新されません。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;var  tmpl = template.Must((template.New(&#34;main.tmpl&#34;)).ParseGlob(&#34;templates/*.tmpl&#34;))

func RootHandler(w http.ResponseWriter, r *http.Request) {
    data = ・・・
    tmpl.Execute(w,data)
    ・・・
}
&lt;/pre&gt;

&lt;p&gt;●Go1.2からテンプレートに比較演算子が使えるようになりましたが(&lt;a href=&#34;http://golang.org/doc/go1.2#text_template&#34; target=&#34;_blank&#34;&gt;本家変更点&lt;/a&gt;, &lt;a href=&#34;https://github.com/kwmt/golangwiki/blob/master/doc/go1.2.md#the-texttemplate-and-htmltemplate-packages&#34; target=&#34;_blank&#34;&gt;翻訳&lt;/a&gt;)、個人的にはテンプレートをあまりプログラムちっくにすべきではないかもしれないと思いました。デザイナーさんにやさしいテンプレートを作成することが関係を良くするポイントかもしれません。&lt;/p&gt;

&lt;p&gt;●(感想というか覚え書きですが)テンプレートでは、ある構造体にレシーバとして定義したメソッドが使えます(&lt;a href=&#34;http://golang.org/pkg/text/template/#hdr-Arguments&#34; target=&#34;_blank&#34;&gt;text/templateパッケージ&lt;/a&gt;)。&lt;/p&gt;

&lt;p&gt;例えば、&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;type Person struct{
    Address int
}

func (p *Person) Method() bool {
    ・・・・
} 
&lt;/pre&gt;

&lt;p&gt;としたとき、テンプレートファイルを、&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;{{if .Method}}
・・・
{{end}}
&lt;/pre&gt;

&lt;p&gt;とすれば、&lt;code&gt;Method&lt;/code&gt;が使えます。&lt;a href=&#34;http://golang.org/pkg/text/template/#FuncMap&#34; target=&#34;_blank&#34;&gt;template.FuncMap&lt;/a&gt;(&lt;a href=&#34;http://bit.ly/1acasGJ&#34; target=&#34;_blank&#34;&gt;使い方&lt;/a&gt;)は、データに紐付けなくてもよい関数を作り、データに関連するものは上記の&lt;code&gt;Method&lt;/code&gt;のように作るようにすれば分かりやすいかなと思います。&lt;/p&gt;

&lt;p&gt;●(これも感想というか覚え書きですが)&lt;a href=&#34;http://golang.org/pkg/net/http/fcgi/&#34; target=&#34;_blank&#34;&gt;fcgi.Serve&lt;/a&gt;関数内で、要求があるたびに新しくゴルーチンを作っています(&lt;a href=&#34;http://golang.org/src/pkg/net/http/fcgi/child.go?s=6606:6660#L262&#34; target=&#34;_blank&#34;&gt;ソース&lt;/a&gt;)。&lt;/p&gt;

&lt;h2 id=&#34;終わりに:c0dbec7fa3cfe404e69f284d2c58d1c4&#34;&gt;終わりに&lt;/h2&gt;

&lt;p&gt;このマッチングサイトのリンクやスクリーンショットを示せず、とても分かりにくかったと思いますが、&amp;#8221;Goってツール系のイメージがある&amp;#8221;とか、&amp;#8221;速さが必要なところでしか使わない&amp;#8221;とか思ってる方に、普通にWebサイトが作れるんだ、ということを少しは知って頂けたかなと思い、終わりにしたいと思います。&lt;/p&gt;

&lt;p&gt;なにかGoに関してご相談ありましたら、&lt;a href=&#34;https://twitter.com/kwmt27&#34;&gt;@kwmt27&lt;/a&gt; までご連絡下さい。最後までお読み頂きありがとうございました。&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>#Nginx &#43; #golang (FastCGI)&#43; #MySQL を使ったWebアプリケーションを書くための準備</title>
      <link>/kwmt27.net/index.php/2013/10/03/nginx-golang-fcgi-mysql/</link>
      <pubDate>Wed, 02 Oct 2013 00:00:00 +0000</pubDate>
      
      <guid>/kwmt27.net/index.php/2013/10/03/nginx-golang-fcgi-mysql/</guid>
      <description>

&lt;h2 id=&#34;はじめに:30541588868439902a1efc8adcbbf1c0&#34;&gt;はじめに&lt;/h2&gt;

&lt;p&gt;下記の記事をみたら分かりやすいかもしれませんが、英語なので、実際にやった方法も交えてメモしておこうと思います。（似てるところもありますが、翻訳ではありません。）&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://mwholt.blogspot.jp/2013/05/writing-go-golang-web-app-with-nginx.html&#34; target=&#34;_blank&#34;&gt;Writing a Go (&amp;#8220;golang&amp;#8221;) Web App with nginx, FastCGI, MySQL, JSON&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;前提として、Go言語でWebサーバーをつくって動かすと言うと２種類の方法があります。&lt;/p&gt;

&lt;p&gt;１つは、Go言語の&lt;a href=&#34;http://golang.org/pkg/net/http/&#34; target=&#34;_blank&#34;&gt;&amp;#8220;net/http&amp;#8221;&lt;/a&gt;パッケージというのがありますので、これを使ってGo自体でWebサーバーを作ってしまうことができます。&lt;/p&gt;

&lt;p&gt;もう1つは、ApacheやNginxなどのWebサーバー上で、CGI(正確にはFastCGI)としてGo言語を動かす方法です。これはNginx+PHP-FPMのようなもに近いイメージだと思います。&lt;/p&gt;

&lt;p&gt;Nginxを使うか使わないかは、こちらの&lt;a href=&#34;http://stackoverflow.com/questions/17776584/webserver-for-go-golang-webservices-using-nginx-or-not&#34; title=&#34;Webserver for Go (golang) webservices: using NGINX or not?&#34; target=&#34;_blank&#34;&gt;Stackoverflow&lt;/a&gt;をみると、&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Go HTTPサーバーはいいんだけど、Webサーバーを一から作るのは大変だよ、Nginxを使った方が簡単だよ&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;みたいな感じで、Nginxつかった方がいいよという結論になってます。&lt;/p&gt;

&lt;p&gt;この記事では、2つ目の方法のNginx+golang(FastCGI)でWebアプリケーションを作る準備をメモしたいと思います。&lt;/p&gt;

&lt;p&gt;データベースとしては、MySQLを使いたいと思います。&lt;/p&gt;

&lt;h2 id=&#34;使用環境:30541588868439902a1efc8adcbbf1c0&#34;&gt;使用環境&lt;/h2&gt;

&lt;pre class=&#34;go&#34;&gt;サーバOS:CentOS release 6.4
Webサーバ:nginx-1.4.1
データベース:mysql  Ver 14.14 Distrib 5.5.27
&lt;/pre&gt;

&lt;h2 id=&#34;1-nginxをインストールする-seciton:30541588868439902a1efc8adcbbf1c0&#34;&gt;1.Nginxをインストールする {.seciton}&lt;/h2&gt;

&lt;p&gt;まずは、CentOSにNginxをソースからインストールしたいと思います。(&lt;a href=&#34;http://wiki.nginx.org/Install&#34; target=&#34;_blank&#34;&gt;Nginx installリンク&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;なぜソースからインストールするのかは、Web+DBにおすすめと書かれていたから(^o^;&lt;/p&gt;

&lt;p&gt;ちゃんというとモジュール追加するには、make時にくっつけとかないといけないからで、必要なければ、rpmとかからインストールしてもいいと思います。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;# wget http://nginx.org/download/nginx-1.4.1.tar.gz
# tar zxvf nginx-1.4.1.tar.gz
# ls
nginx-1.4.1
# cd nginx-1.4.1
# ./configure
&lt;/pre&gt;

&lt;p&gt;雑誌Web+DB pressのVol12.2013には下記のように指定してましたが、個人的にはデフォルトの方が分かりやすいため、特にオプション指定はしていません。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;# ./configure --prefix=/usr/local --conf-path=/etc/nginx/nginx.conf 
&lt;/pre&gt;

&lt;p&gt;デフォルトでは、Nginxは/usr/local/nginxにインストールされます。&lt;/p&gt;

&lt;p&gt;nginxのサービスを起動したりするコマンドは、/usr/local/nginx/sbinの中にあるnginxコマンドなので、PATHを設定しておくと楽になるかと思います。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;bashの場合 .bashrcに下記を記入
export PATH=/usr/local/nginx/sbin:$PATH
&lt;/pre&gt;

&lt;p&gt;さて、&lt;code&gt;./configure&lt;/code&gt;の時点に少し戻ります。私の環境では、&lt;code&gt;./configure&lt;/code&gt;時に下記の2つのエラーが出ましたので、それらについてのエラー内容と対策も書いておきたいと思います。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;【./configure時のエラー１】
./configure: error: the HTTP rewrite module requires the PCRE library.
【対策】
# yum -y install pcre pcre-devel

【./configure時のエラー２】
./configure: error: the HTTP gzip module requires the zlib library.
【対策】
# yum -y install zlib-devel

※参考
&lt;a href=&#34;http://bit.ly/19V1ahY&#34; target=&#34;_blank&#34;&gt;64bit版CentOS 5.3にnginxをインストールしてみた - Umeyashikiの日記&lt;/a&gt; 
&lt;/pre&gt;

&lt;p&gt;これで&lt;code&gt;./configure&lt;/code&gt;が正常に終了したと思いますので、下記のようにしてインストールしましょう。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;# make
# make install
&lt;/pre&gt;

&lt;p&gt;以上で、Nginxのインストールは終了です。&lt;/p&gt;

&lt;p&gt;次に、Nginxの設定に行きたいところですが、インストールを終わらせてしまいましょう。&lt;/p&gt;

&lt;h2 id=&#34;2-go-toolsをインストール:30541588868439902a1efc8adcbbf1c0&#34;&gt;2.Go Toolsをインストール&lt;/h2&gt;

&lt;p&gt;基本的には本家サイトの&lt;a href=&#34;http://golang.org/doc/install&#34; target=&#34;_blank&#34;&gt;Getting Started&lt;/a&gt;をみてください。&lt;/p&gt;

&lt;p&gt;簡単に言うと、こちらから環境にあったものをインストールするか、&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://golang.org/dl/&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;https://golang.org/dl/&#34;&gt;https://golang.org/dl/&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ソースからインストールする場合には、拙作ですが、gitが入っていれば数回のコマンド入力でgoがインストールできます。「Mercurialが入ってなければ、Mercurialをインストールする」というような工程はもう必要ありません。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/kwmt/goinstall&#34; title=&#34;goinstall&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;https://github.com/kwmt/goinstall&#34;&gt;https://github.com/kwmt/goinstall&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;こちらもお勧めです。(Linux,Macのみ対応しています。)&lt;/p&gt;

&lt;h2 id=&#34;3-mysqlをインストールする:30541588868439902a1efc8adcbbf1c0&#34;&gt;3.MySQLをインストールする&lt;/h2&gt;

&lt;p&gt;ググりましょう。&lt;/p&gt;

&lt;h2 id=&#34;4-nginxの設定をする:30541588868439902a1efc8adcbbf1c0&#34;&gt;4.Nginxの設定をする&lt;/h2&gt;

&lt;p&gt;FastCGIを使うには、locationディレクティブに次のような感じで設定するようです。&lt;/p&gt;

&lt;p&gt;この例だと、ポート8080にアクセスがきたら、ポート9000にアクセスするようになります。（作るアプリによっては実用的ではないかもしれません）&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;server {
    listen       8080;
    server_name  localhost;

    location / {
        fastcgi_pass 127.0.0.1:9000;
        include fastcgi.conf;
    }
}
&lt;/pre&gt;

&lt;p&gt;Basic認証を掛ける方法は、&lt;a href=&#34;http://bit.ly/17eWMgm&#34; target=&#34;_blank&#34;&gt;【Nginx】Basic認証をかける&lt;/a&gt;を参考にさせて頂きました。&lt;/p&gt;

&lt;p&gt;実際の設定としては次のようになります。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;location /admin {
            auth_basic &#34;members onry&#34;;
            auth_basic_user_file &#34;/etc/nginx/.htpasswd&#34;;
            fastcgi_pass 127.0.0.1:9000;
            include fastcgi.conf;
        }
&lt;/pre&gt;

&lt;p&gt;設定が終わったので、Nginxを起動させましょう。起動するには、&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;# nginx
&lt;/pre&gt;

&lt;p&gt;です。&lt;/p&gt;

&lt;p&gt;再起動と停止は次のようにします。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;# nginx -s reload //再起動
# nignx -s stop   //停止
&lt;/pre&gt;

&lt;h2 id=&#34;5-go言語プログラムをfastcgiとして動かすためには:30541588868439902a1efc8adcbbf1c0&#34;&gt;5.Go言語プログラムをFastCGIとして動かすためには&lt;/h2&gt;

&lt;p&gt;何も出力しませんが、localhost:9000で接続要求を待ってくれます。この&amp;#8221;9000&amp;#8243;はNginx側の設定の9000と合わせる必要があります。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;package main
import (
    &#34;net/http&#34;
    &#34;net/http/fcgi&#34;
)
func main(){
    l,_:= net.Listen(&#34;tcp&#34;,&#34;:9000&#34;)
    mux := http.NewServeMux()
    fcgi.Serve(l,mux)
}
&lt;/pre&gt;

&lt;p&gt;ちなみに、下記は&lt;a href=&#34;http://golang.org/pkg/net/http/fcgi/#Serve&#34; target=&#34;_blank&#34;&gt;&amp;#8220;net/http/fcgi&amp;#8221;&lt;/a&gt;パッケージのServe関数の翻訳です。Serve関数で何をやってるのかが分かるかと思います。&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Serve関数はリスナー&lt;code&gt;l&lt;/code&gt;(エル)上で、FastCGI接続を待ち受け、それぞれに対して新しいゴルーチンを作ります。&lt;/p&gt;

&lt;p&gt;そのゴルーチンはリクエストを解釈し、リクエストに応答する&lt;code&gt;handler&lt;/code&gt;をコールします。&lt;code&gt;l&lt;/code&gt;(エル)が&lt;code&gt;nil&lt;/code&gt;の場合、&lt;code&gt;Serve&lt;/code&gt;関数は、&lt;code&gt;os.Stdin&lt;/code&gt;からの接続を受け入れます。&lt;code&gt;handler&lt;/code&gt;が&lt;code&gt;nil&lt;/code&gt;の場合、&lt;code&gt;http.DefaultServeMux&lt;/code&gt;が使われます。&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;6-go言語からmysqlを使うには:30541588868439902a1efc8adcbbf1c0&#34;&gt;6.Go言語からMySQLを使うには&lt;/h2&gt;

&lt;p&gt;ドライバを下記からインストールする必要があります。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://golang.org/s/sqldrivers&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://golang.org/s/sqldrivers&#34;&gt;http://golang.org/s/sqldrivers&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;上のリストをみると、MySQLのドライバは2つあるのですが、たとえば、go-sql-driver/mysqlをインストールするには次のようにします。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;$ go get github.com/go-sql-driver/mysql
&lt;/pre&gt;

&lt;p&gt;使い方については、下記が参考になると思います。&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/go-sql-driver/mysql/wiki/Examples&#34; target=&#34;_blank&#34;&gt;wikiにあるExamples&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://qiita.com/tenntenn/items/dddb13c15643454a7c3b&#34; target=&#34;_blank&#34;&gt;[Go言語] database/sqlパッケージを使ってみた&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;もう1つのドライバmymysqlについては、過去記事をご参照ください。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://kwmt27.net/index.php/2012/09/06/golang%e3%81%8b%e3%82%89mysql%e3%82%92%e4%bd%bf%e3%81%86%e3%81%ab%e3%81%af/&#34; title=&#34;golangからMySQLを使うには&#34; target=&#34;_blank&#34;&gt;golangからMySQLを使うには&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;補足-mysqlから取得した日本語が文字化けする件:30541588868439902a1efc8adcbbf1c0&#34;&gt;補足：mysqlから取得した日本語が文字化けする件&lt;/h2&gt;

&lt;p&gt;※Mac OSのみかもしれない.&lt;/p&gt;

&lt;p&gt;【原因】&lt;/p&gt;

&lt;p&gt;Server側とClient側の文字コードが異なっていたため。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;Server characterset:    latin1
Db     characterset:    latin1
Client characterset:    utf8
Conn.  characterset:    utf8
&lt;/pre&gt;

&lt;p&gt;【対策】&lt;/p&gt;

&lt;p&gt;macでは&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;/etc/my.conf
&lt;/pre&gt;

&lt;pre class=&#34;go&#34;&gt;[client]
default-character-set=utf8
...
[mysqld]
character-set-server=utf8 #ここだけ 違うので注意
...
[mysqldump]
...
default-character-set=utf8  
[mysql]
...
default-character-set=utf8
&lt;/pre&gt;

&lt;p&gt;あとはmysqlを再起動する&lt;/p&gt;

&lt;p&gt;（macの場合はシステム環境設定-&amp;gt;MySQL-&amp;gt;Stop MySQL Server -&amp;gt;Start MySQL Server）&lt;/p&gt;

&lt;p&gt;※参考&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://d.hatena.ne.jp/nightmare_tim/20110530/1306704112&#34;&gt;fedora15 mysql5.5 default-character-setが原因で起動できない&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;補足-go言語でクロスコンパイルするには:30541588868439902a1efc8adcbbf1c0&#34;&gt;補足：Go言語でクロスコンパイルするには&lt;/h2&gt;

&lt;p&gt;まだ試したことないですが、とりあえずメモがてら。ためして何か分かったら更新するかもです。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://bit.ly/1g3egQA&#34; target=&#34;_blank&#34;&gt;Go言語でクロスコンパイルする &amp;#8211; memoメモ&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;おわりに:30541588868439902a1efc8adcbbf1c0&#34;&gt;おわりに&lt;/h2&gt;

&lt;p&gt;これでひとまずNginx+golang(fcgi)+MySQLの環境が整ったとおもいますので、あとは&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://golang.org/doc/articles/wiki/&#34; target=&#34;_blank&#34;&gt;Writing Web Applications&lt;/a&gt;(&lt;a href=&#34;https://github.com/kwmt/golangwiki/blob/master/doc/articles/wiki.md&#34; target=&#34;_blank&#34;&gt;日本語訳&lt;/a&gt;)(スライド：&lt;a href=&#34;http://www.slideshare.net/yasi_life/goweb-16448500&#34; target=&#34;_blank&#34;&gt;Go言語によるwebアプリの作り方&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;のような記事を読むと良いと思います。&lt;/p&gt;

&lt;h2 id=&#34;参考リンク:30541588868439902a1efc8adcbbf1c0&#34;&gt;参考リンク&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://mwholt.blogspot.jp/2013/05/writing-go-golang-web-app-with-nginx.html&#34; target=&#34;_blank&#34;&gt;Writing a Go (&amp;#8220;golang&amp;#8221;) Web App with nginx, FastCGI, MySQL, JSON&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://stackoverflow.com/questions/17776584/webserver-for-go-golang-webservices-using-nginx-or-not&#34; title=&#34;Webserver for Go (golang) webservices: using NGINX or not?&#34; target=&#34;_blank&#34;&gt;Stackoverflow:Webserver for Go (golang) webservices: using NGINX or not?&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://golang.org/pkg/net/http/&#34; target=&#34;_blank&#34;&gt;&amp;#8220;net/http&amp;#8221;&lt;/a&gt;パッケージ&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://golang.org/pkg/net/http/fcgi/#Serve&#34; target=&#34;_blank&#34;&gt;&amp;#8220;net/http/fcgi&amp;#8221;&lt;/a&gt;パッケージ&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://wiki.nginx.org/Install&#34; target=&#34;_blank&#34;&gt;Nginx installリンク&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/19V1ahY&#34; target=&#34;_blank&#34;&gt;64bit版CentOS 5.3にnginxをインストールしてみた &amp;#8211; Umeyashikiの日記&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/17eWMgm&#34; target=&#34;_blank&#34;&gt;【Nginx】Basic認証をかける&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://golang.org/doc/install&#34; target=&#34;_blank&#34;&gt;Getting Started&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://golang.org/dl/&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;https://golang.org/dl/&#34;&gt;https://golang.org/dl/&lt;/a&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/kwmt/goinstall&#34; title=&#34;goinstall&#34; target=&#34;_blank&#34;&gt;goinstall&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://golang.org/s/sqldrivers&#34; target=&#34;_blank&#34;&gt;SQLDrivers &amp;#8211; go-wiki &amp;#8211; SQL database drivers &amp;#8211; Go Language Community Wiki &amp;#8211; Google Project Hosting&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/go-sql-driver/mysql/wiki/Examples&#34; target=&#34;_blank&#34;&gt;wikiにあるExamples&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://qiita.com/tenntenn/items/dddb13c15643454a7c3b&#34; target=&#34;_blank&#34;&gt;[Go言語] database/sqlパッケージを使ってみた&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://kwmt27.net/index.php/2012/09/06/golang%e3%81%8b%e3%82%89mysql%e3%82%92%e4%bd%bf%e3%81%86%e3%81%ab%e3%81%af/&#34; title=&#34;golangからMySQLを使うには&#34; target=&#34;_blank&#34;&gt;golangからMySQLを使うには&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://d.hatena.ne.jp/nightmare_tim/20110530/1306704112&#34;&gt;fedora15 mysql5.5 default-character-setが原因で起動できない&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/1g3egQA&#34; target=&#34;_blank&#34;&gt;Go言語でクロスコンパイルする &amp;#8211; memoメモ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>