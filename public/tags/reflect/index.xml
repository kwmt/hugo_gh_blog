<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Reflect on Androg</title>
    <link>kwmt27.net/tags/reflect/</link>
    <description>Recent content in Reflect on Androg</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja</language>
    <lastBuildDate>Sat, 12 Oct 2013 00:00:00 +0000</lastBuildDate>
    <atom:link href="kwmt27.net/tags/reflect/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>#golang mapからstructに変換するには？</title>
      <link>/kwmt27.net/index.php/2013/10/13/how-to-convert-from-map-to-struct/</link>
      <pubDate>Sat, 12 Oct 2013 00:00:00 +0000</pubDate>
      
      <guid>/kwmt27.net/index.php/2013/10/13/how-to-convert-from-map-to-struct/</guid>
      <description>

&lt;h2 id=&#34;reflect-pkgを使った方法:6a6ec8ccc2e96e6ec0438624473d174f&#34;&gt;reflect pkgを使った方法&lt;/h2&gt;

&lt;p&gt;最初はなんとなくリフレクションを使ってやるのかなぁと思って、調べてたらこんな感じのが出てました。（&lt;a href=&#34;http://bit.ly/1axEplM&#34; target=&#34;_blank&#34;&gt;参考リンク&lt;/a&gt;）&lt;/p&gt;


&lt;script src=&#34;//gist.github.com/6938201.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;&lt;a href=&#34;http://play.golang.org/p/5Inl2jO7zL&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://play.golang.org/p/5Inl2jO7zL&#34;&gt;http://play.golang.org/p/5Inl2jO7zL&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;encoding-json-pkgを使った方法:6a6ec8ccc2e96e6ec0438624473d174f&#34;&gt;encoding/json pkgを使った方法&lt;/h2&gt;

&lt;p&gt;ただちょっとこれだと扱いにくくて(MapToStructの中身を修正すれば扱いやすくなるかもしれないですが)、パフォーマンスを気にしなければ、mapを一旦JSONにして、そのJSONをstructにするという方法が扱いやすいということを教えてもらいました。&lt;/p&gt;


&lt;script src=&#34;//gist.github.com/6950666.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;&lt;a href=&#34;http://play.golang.org/p/Kd7TRoRG5w&#34;&gt;http://play.golang.org/p/Kd7TRoRG5w&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;ライブラリmapstructureを使う方法:6a6ec8ccc2e96e6ec0438624473d174f&#34;&gt;ライブラリmapstructureを使う方法&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;https://github.com/mitchellh/mapstructure&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;https://github.com/mitchellh/mapstructure&#34;&gt;https://github.com/mitchellh/mapstructure&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;mapstructure.Decode関数を使えばよさげ。&lt;/p&gt;

&lt;h2 id=&#34;補足-mapから-map-string-interface-に変換する方法:6a6ec8ccc2e96e6ec0438624473d174f&#34;&gt;補足：mapから map[string]interface{}に変換する方法&lt;/h2&gt;

&lt;p&gt;最初は、MapToStructの第一引数にmap[string][]stringをそのまま渡してて、valueのところがスライスだったらだめなのかな？と思ってましたが、map[string]interface{}に変換すればいいだけってのを教えてもらって、次のような変換で解決しました。&lt;/p&gt;

&lt;pre class=&#34;go&#34;&gt;m := map[string][]string{
    &#34;1&#34;:[]string{&#34;a&#34;,&#34;b&#34;},
    &#34;2&#34;:[]string{&#34;C&#34;,&#34;d&#34;},
}
// convert map to a map[string]interface{}
mi := make(map[string]interface{}, len(m))
for k, v := range mm {
    mi[k] = v
}
&lt;/pre&gt;

&lt;h2 id=&#34;補足-個人的なきっかけ:6a6ec8ccc2e96e6ec0438624473d174f&#34;&gt;補足：個人的なきっかけ&lt;/h2&gt;

&lt;pre class=&#34;go&#34;&gt;var r *http.Request
r.Form (= url.Values = map[string][]string)
&lt;/pre&gt;

&lt;p&gt;POSTリクエストがきた時のr.Formを構造体に一時的に格納したいのですが、格納先の構造体のフィールドがやたら多い場合、一個ずつ格納するのが面倒だなというのがきっかけでした。&lt;/p&gt;

&lt;h2 id=&#34;参考:6a6ec8ccc2e96e6ec0438624473d174f&#34;&gt;参考&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://groups.google.com/forum/#!topic/golang-nuts/2PCtqxyirVE&#34; target=&#34;_blank&#34;&gt;how to convert map to struct &amp;#8211; Google グループ&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/1axEplM&#34; target=&#34;_blank&#34;&gt;Ideone.com &amp;#8211; XWtlo &amp;#8211; Online Go Compiler &amp;#038; Debugging Tool&lt;/a&gt;（これはGo1以前のソースなのでそのままでは動かない）&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/1axEFRY&#34; target=&#34;_blank&#34;&gt;struct &amp;lt;-&amp;gt; map[string]interface{} conversion &amp;#8211; Google グループ&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>#golang リフレクションを使って、キャストするには？</title>
      <link>/kwmt27.net/index.php/2013/10/09/how-to-cast-with-reflect-of-golang/</link>
      <pubDate>Wed, 09 Oct 2013 00:00:00 +0000</pubDate>
      
      <guid>/kwmt27.net/index.php/2013/10/09/how-to-cast-with-reflect-of-golang/</guid>
      <description>


&lt;script src=&#34;//gist.github.com/6895772.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;&lt;a href=&#34;http://play.golang.org/p/gvadP4k1Bo&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://play.golang.org/p/gvadP4k1Bo&#34;&gt;http://play.golang.org/p/gvadP4k1Bo&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://golang.org/pkg/strconv/#FormatInt&#34; target=&#34;_blank&#34;&gt;strconv.FormatInt&lt;/a&gt;の第一引数は&amp;#8221;int64&amp;#8243;型で、&lt;a href=&#34;http://golang.org/pkg/strconv/#FormatUint&#34; target=&#34;_blank&#34;&gt;strconv.FormatUint&lt;/a&gt;の第一引数は&amp;#8221;uint64&amp;#8243;型です。&lt;/p&gt;

&lt;p&gt;たとえば、ただ100と書くとint型になりますので、fv.Callの引数のところで、キャストしてあげる必要があります。キャストするには、reflectパッケージの&lt;a href=&#34;http://golang.org/pkg/reflect/#Value.Convert&#34; target=&#34;_blank&#34;&gt;Convertメソッド&lt;/a&gt;を使います。&lt;/p&gt;

&lt;p&gt;ほとんど同じ処理で、ある一部分だけ異なる関数を使っているという場合に役に立つと思います。&lt;/p&gt;

&lt;p&gt;ちなみに、このConvertメソッドは、go1.1のリリース時に追加されました。&lt;/p&gt;

&lt;p&gt;&lt;a href=&#34;http://golang.org/doc/go1.1#reflect&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://golang.org/doc/go1.1#reflect&#34;&gt;http://golang.org/doc/go1.1#reflect&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;参考:dd3051da1cf2545fdceed9633c9e293f&#34;&gt;参考&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/1fWdHYS&#34; target=&#34;_blank&#34; class=&#34;broken_link&#34;&gt;goken/goken08-reflect.md at master · goken/goken&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://golang.org/pkg/reflect/#Value.Convert&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://golang.org/pkg/reflect/#Value.Convert&#34;&gt;http://golang.org/pkg/reflect/#Value.Convert&lt;/a&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/1ctDnMp&#34; target=&#34;_blank&#34;&gt;#golang リフレクションを使って、関数の引数の型を取得するには？ | Androg&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/1ctDtDT&#34; target=&#34;_blank&#34;&gt;#golang リフレクションを使って、関数をコールするには？ | Androg&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>#golang リフレクションを使って、関数の引数の型を取得するには？</title>
      <link>/kwmt27.net/index.php/2013/10/09/how-to-get-function-arg-type-with-reflect-of-golang/</link>
      <pubDate>Wed, 09 Oct 2013 00:00:00 +0000</pubDate>
      
      <guid>/kwmt27.net/index.php/2013/10/09/how-to-get-function-arg-type-with-reflect-of-golang/</guid>
      <description>


&lt;script src=&#34;//gist.github.com/6895177.js&#34;&gt;&lt;/script&gt;


&lt;h2 id=&#34;参考:b6a95452afe1d4c92c27b37ba552d1b6&#34;&gt;参考&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/1fWdHYS&#34; target=&#34;_blank&#34; class=&#34;broken_link&#34;&gt;goken/goken08-reflect.md at master · goken/goken&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://golang.org/src/pkg/reflect/type.go?#L157&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://golang.org/src/pkg/reflect/type.go?#L157&#34;&gt;http://golang.org/src/pkg/reflect/type.go?#L157&lt;/a&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>#golang リフレクションを使って、関数をコールするには？</title>
      <link>/kwmt27.net/index.php/2013/10/09/how-to-call-function-with-reflect-of-golang/</link>
      <pubDate>Wed, 09 Oct 2013 00:00:00 +0000</pubDate>
      
      <guid>/kwmt27.net/index.php/2013/10/09/how-to-call-function-with-reflect-of-golang/</guid>
      <description>


&lt;script src=&#34;//gist.github.com/6895428.js&#34;&gt;&lt;/script&gt;


&lt;h2 id=&#34;参考:a7253945f587662917148ac6e1019182&#34;&gt;参考&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/1fWdHYS&#34; target=&#34;_blank&#34; class=&#34;broken_link&#34;&gt;goken/goken08-reflect.md at master · goken/goken&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://golang.org/pkg/reflect/#Value.Call&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://golang.org/pkg/reflect/#Value.Call&#34;&gt;http://golang.org/pkg/reflect/#Value.Call&lt;/a&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>#golang リフレクションを使って関数名を取得するには？</title>
      <link>/kwmt27.net/index.php/2013/10/05/golang-how-to-get-function-name-with-reflection/</link>
      <pubDate>Sat, 05 Oct 2013 00:00:00 +0000</pubDate>
      
      <guid>/kwmt27.net/index.php/2013/10/05/golang-how-to-get-function-name-with-reflection/</guid>
      <description>

&lt;p&gt;&lt;a href=&#34;http://golang.org/pkg/reflect/&#34; target=&#34;_blank&#34;&gt;&amp;#8220;reflect&amp;#8221;&lt;/a&gt;パッケージだけでは取得できないようで、&lt;a href=&#34;http://golang.org/pkg/runtime/&#34; target=&#34;_blank&#34;&gt;&amp;#8220;runtime&amp;#8221;&lt;/a&gt;パッケージの&lt;code&gt;&amp;lt;a href=&amp;quot;http://golang.org/pkg/runtime/#FuncForPC&amp;quot; target=&amp;quot;_blank&amp;quot;&amp;gt;FuncForPC&amp;lt;/a&amp;gt;&lt;/code&gt;という関数を使うようです。&lt;/p&gt;


&lt;script src=&#34;//gist.github.com/6840466.js&#34;&gt;&lt;/script&gt;


&lt;h2 id=&#34;参考:69498b034e47686ef53c806c66b6fa56&#34;&gt;参考&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/1a0Zfsp&#34; target=&#34;_blank&#34;&gt;reflection &amp;#8211; How to get the name of a function in Go? &amp;#8211; Stack Overflow&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://bit.ly/1fWdHYS&#34; target=&#34;_blank&#34; class=&#34;broken_link&#34;&gt;goken/goken08-reflect.md at master · goken/goken&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>#golang リフレクションを使って、構造体フィールドの値を取得するには？</title>
      <link>/kwmt27.net/index.php/2013/10/02/get-field-value-of-struct-with-reflect-golang/</link>
      <pubDate>Wed, 02 Oct 2013 00:00:00 +0000</pubDate>
      
      <guid>/kwmt27.net/index.php/2013/10/02/get-field-value-of-struct-with-reflect-golang/</guid>
      <description>

&lt;p&gt;リフレクションを使って、構造体フィールドの値を取得するには？&lt;/p&gt;


&lt;script src=&#34;//gist.github.com/6792088.js&#34;&gt;&lt;/script&gt;


&lt;p&gt;&lt;a href=&#34;http://play.golang.org/p/Tp5S6AVDB8&#34; target=&#34;_blank&#34;&gt;&lt;a href=&#34;http://play.golang.org/p/Tp5S6AVDB8&#34;&gt;http://play.golang.org/p/Tp5S6AVDB8&lt;/a&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;参考:7fa19f7cd3dd22f862eee8866f2bc941&#34;&gt;参考&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/goken/goken/blob/master/goken08-reflect/goken08-reflect.md&#34; target=&#34;_blank&#34;&gt;Go研 Vol.8&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>#golang リフレクションを使って、構造体フィールドの値を変更するには？</title>
      <link>/kwmt27.net/index.php/2013/10/02/change-struct-field-value-with-reflect-golang/</link>
      <pubDate>Wed, 02 Oct 2013 00:00:00 +0000</pubDate>
      
      <guid>/kwmt27.net/index.php/2013/10/02/change-struct-field-value-with-reflect-golang/</guid>
      <description>

&lt;p&gt;リフレクションを使って、構造体フィールドの値を変更するには？&lt;/p&gt;


&lt;script src=&#34;//gist.github.com/6792127.js&#34;&gt;&lt;/script&gt;


&lt;h2 id=&#34;参考:72fe90f91e75b9c8fc516f44ecb54c95&#34;&gt;参考&lt;/h2&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;https://github.com/goken/goken/blob/master/goken08-reflect/goken08-reflect.md&#34; target=&#34;_blank&#34;&gt;Go研 Vol.8&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
  </channel>
</rss>